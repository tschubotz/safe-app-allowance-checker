{"version":3,"sources":["GlobalStyle.ts","abis/Erc20.ts","App.tsx","index.tsx"],"names":["GlobalStyle","createGlobalStyle","avertaFont","avertaBoldFont","web3","Web3","process","Container","styled","form","App","safe","useSafe","useState","fetching","setFetching","Array","allowances","setAllowances","etherscanLink","info","network","useEffect","fetchAllowances","resetAllowance","useCallback","tokenAddress","spender","a","erc20Contract","eth","Contract","erc20Abi","console","log","safeAddress","sendTransactions","methods","approve","encodeABI","safeTxHash","error","getPastEvents","filter","owner","fromBlock","toBlock","approvals","uniqueApprovals","Set","forEach","approval","add","token","uniqueApprovalsArray","from","tokenContract","allowance","call","BN","toString","isZero","decimals","symbol","push","size","color","onClick","TableContainer","Table","TableHead","TableRow","TableCell","TableBody","map","index","key","href","target","divisor","pow","beforeDecimal","div","afterDecimal","mod","getAllowanceString","ReactDOM","render","StrictMode","theme","loading","document","getElementById"],"mappings":"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","file":"static/js/main.ce8fdc47.chunk.js","sourcesContent":["import { createGlobalStyle } from \"styled-components\";\nimport avertaFont from \"@gnosis.pm/safe-react-components/dist/fonts/averta-normal.woff2\";\nimport avertaBoldFont from \"@gnosis.pm/safe-react-components/dist/fonts/averta-bold.woff2\";\n\nconst GlobalStyle = createGlobalStyle`\n    html {\n        height: 100%\n    }\n\n    body {\n       height: 100%;\n       margin: 0px;\n       padding: 0px;\n    }\n\n    #root {\n        height: 100%;\n        padding-right: 0.5rem;\n    }\n\n    .MuiFormControl-root,\n    .MuiInputBase-root {\n        width: 100% !important;\n    }\n\n    @font-face {\n        font-family: 'Averta';\n        src: local('Averta'), local('Averta Bold'),\n        url(${avertaFont}) format('woff2'),\n        url(${avertaBoldFont}) format('woff');\n    }\n`;\n\nexport default GlobalStyle;\n","export default [\n    {\n       \"constant\":true,\n       \"inputs\":[\n          \n       ],\n       \"name\":\"name\",\n       \"outputs\":[\n          {\n             \"name\":\"\",\n             \"type\":\"string\"\n          }\n       ],\n       \"payable\":false,\n       \"type\":\"function\"\n    },\n    {\n       \"constant\":false,\n       \"inputs\":[\n          {\n             \"name\":\"_spender\",\n             \"type\":\"address\"\n          },\n          {\n             \"name\":\"_value\",\n             \"type\":\"uint256\"\n          }\n       ],\n       \"name\":\"approve\",\n       \"outputs\":[\n          {\n             \"name\":\"\",\n             \"type\":\"bool\"\n          }\n       ],\n       \"payable\":false,\n       \"type\":\"function\"\n    },\n    {\n       \"constant\":true,\n       \"inputs\":[\n          \n       ],\n       \"name\":\"totalSupply\",\n       \"outputs\":[\n          {\n             \"name\":\"\",\n             \"type\":\"uint256\"\n          }\n       ],\n       \"payable\":false,\n       \"type\":\"function\"\n    },\n    {\n       \"constant\":false,\n       \"inputs\":[\n          {\n             \"name\":\"_from\",\n             \"type\":\"address\"\n          },\n          {\n             \"name\":\"_to\",\n             \"type\":\"address\"\n          },\n          {\n             \"name\":\"_value\",\n             \"type\":\"uint256\"\n          }\n       ],\n       \"name\":\"transferFrom\",\n       \"outputs\":[\n          {\n             \"name\":\"\",\n             \"type\":\"bool\"\n          }\n       ],\n       \"payable\":false,\n       \"type\":\"function\"\n    },\n    {\n       \"constant\":true,\n       \"inputs\":[\n          \n       ],\n       \"name\":\"decimals\",\n       \"outputs\":[\n          {\n             \"name\":\"\",\n             \"type\":\"uint8\"\n          }\n       ],\n       \"payable\":false,\n       \"type\":\"function\"\n    },\n    {\n       \"constant\":true,\n       \"inputs\":[\n          {\n             \"name\":\"_owner\",\n             \"type\":\"address\"\n          }\n       ],\n       \"name\":\"balanceOf\",\n       \"outputs\":[\n          {\n             \"name\":\"\",\n             \"type\":\"uint256\"\n          }\n       ],\n       \"payable\":false,\n       \"type\":\"function\"\n    },\n    {\n       \"constant\":true,\n       \"inputs\":[\n          \n       ],\n       \"name\":\"symbol\",\n       \"outputs\":[\n          {\n             \"name\":\"\",\n             \"type\":\"string\"\n          }\n       ],\n       \"payable\":false,\n       \"type\":\"function\"\n    },\n    {\n       \"constant\":false,\n       \"inputs\":[\n          {\n             \"name\":\"_to\",\n             \"type\":\"address\"\n          },\n          {\n             \"name\":\"_value\",\n             \"type\":\"uint256\"\n          }\n       ],\n       \"name\":\"transfer\",\n       \"outputs\":[\n          {\n             \"name\":\"\",\n             \"type\":\"bool\"\n          }\n       ],\n       \"payable\":false,\n       \"type\":\"function\"\n    },\n    {\n       \"constant\":true,\n       \"inputs\":[\n          {\n             \"name\":\"_owner\",\n             \"type\":\"address\"\n          },\n          {\n             \"name\":\"_spender\",\n             \"type\":\"address\"\n          }\n       ],\n       \"name\":\"allowance\",\n       \"outputs\":[\n          {\n             \"name\":\"\",\n             \"type\":\"uint256\"\n          }\n       ],\n       \"payable\":false,\n       \"type\":\"function\"\n    },\n    {\n       \"inputs\":[\n          {\n             \"name\":\"dutchAuction\",\n             \"type\":\"address\"\n          },\n          {\n             \"name\":\"owners\",\n             \"type\":\"address[]\"\n          },\n          {\n             \"name\":\"tokens\",\n             \"type\":\"uint256[]\"\n          }\n       ],\n       \"payable\":false,\n       \"type\":\"constructor\"\n    },\n    {\n       \"anonymous\":false,\n       \"inputs\":[\n          {\n             \"indexed\":true,\n             \"name\":\"from\",\n             \"type\":\"address\"\n          },\n          {\n             \"indexed\":true,\n             \"name\":\"to\",\n             \"type\":\"address\"\n          },\n          {\n             \"indexed\":false,\n             \"name\":\"value\",\n             \"type\":\"uint256\"\n          }\n       ],\n       \"name\":\"Transfer\",\n       \"type\":\"event\"\n    },\n    {\n       \"anonymous\":false,\n       \"inputs\":[\n          {\n             \"indexed\":true,\n             \"name\":\"owner\",\n             \"type\":\"address\"\n          },\n          {\n             \"indexed\":true,\n             \"name\":\"spender\",\n             \"type\":\"address\"\n          },\n          {\n             \"indexed\":false,\n             \"name\":\"value\",\n             \"type\":\"uint256\"\n          }\n       ],\n       \"name\":\"Approval\",\n       \"type\":\"event\"\n    }\n ]","import React, { useCallback, useEffect, useState } from 'react';\nimport styled from \"styled-components\";\nimport { Button, Loader, Title, Text } from \"@gnosis.pm/safe-react-components\";\nimport { useSafe } from '@rmeissner/safe-apps-react-sdk';\nimport Web3 from \"web3\";\n\n\nimport erc20Abi from \"./abis/Erc20\";\nimport { Table, TableBody, TableCell, TableContainer, TableHead, TableRow } from '@material-ui/core';\nimport BN from 'bn.js'\n\nexport const web3Provider = process.env.REACT_APP_WEB3_PROVIDER_URL || \"\";\nconst web3: any = new Web3(web3Provider);\n\ninterface IApproval {\n  token: string;\n  spender: string;\n}\n\ninterface IAllowance {\n  token: string;\n  symbol: string;\n  spender: string;\n  allowance: BN;\n  decimals: BN;\n}\n\nconst Container = styled.form`\n  margin-bottom: 2rem;\n  width: 100%;\n  max-width: 480px;\n\n  display: grid;\n  grid-template-columns: 1fr;\n  grid-column-gap: 1rem;\n  grid-row-gap: 1rem;\n`;\n\nconst App: React.FC = () => {\n  const safe = useSafe()\n  const [fetching, setFetching] = useState(false)\n  const [allowances, setAllowances] = useState(new Array<IAllowance>());\n  const etherscanLink = safe.info.network === \"rinkeby\"? \"https://rinkeby.etherscan.io/\" : \"https://etherscan.io/\";\n\n  const getAllowanceString = function(allowance:BN, decimals:BN) {\n    const divisor = new BN(10).pow(decimals);\n    const beforeDecimal = allowance.div(divisor);\n    const afterDecimal  = allowance.mod(divisor);\n\n    return beforeDecimal.toString() + \".\" + afterDecimal.toString();\n  }\n\n  useEffect(() => {\n    fetchAllowances();\n  },[]);\n\n  const resetAllowance = useCallback(async (tokenAddress, spender) => {\n    try {\n      const erc20Contract = new web3.eth.Contract(erc20Abi, tokenAddress);\n        console.log(safe.info.safeAddress);\n\n        const safeTxHash = await safe.sendTransactions([\n          {\n            \"to\": tokenAddress,\n            \"value\": \"0\",\n            \"data\": erc20Contract.methods.approve(spender, 0).encodeABI()\n          }\n        ])\n        console.log({safeTxHash})\n        // const safeTx = await safe.loadSafeTransaction(safeTxHash)\n        // console.log({safeTx})\n      } catch (e) {\n        console.error(e)\n      }\n  }, []);\n\n  const fetchAllowances = useCallback(async () => {\n    setFetching(true);\n    const erc20Contract = new web3.eth.Contract(erc20Abi);\n\n    // Get all Approval events\n    const approvals = await erc20Contract.getPastEvents(\"Approval\",\n      {\n        filter: { owner: safe.info.safeAddress },\n        fromBlock: 0,\n        toBlock: 'latest'\n      });\n\n\n    // Get unique approvals since we are gonna double check approvals anyway again.\n    const uniqueApprovals = new Set<IApproval>();\n\n    // TODO what if error\n\n    approvals.forEach((approval: any) => {\n      uniqueApprovals.add({ token: approval[\"address\"], spender: approval[\"returnValues\"][1] });\n    });\n\n    // convert to array to have array functions.\n    const uniqueApprovalsArray = Array.from(uniqueApprovals);\n    \n    // Now get the current allowance for each one\n    const allowances = new Array<IAllowance>();\n\n    for await (const approval of uniqueApprovalsArray) {\n      const tokenContract = new web3.eth.Contract(erc20Abi, approval.token);\n\n      let allowance: BN = await tokenContract.methods.allowance(safe.info.safeAddress, approval.spender).call();\n      allowance = new BN(allowance.toString());  // didn't work without oO\n\n      // don't show zero balances\n      if (allowance.isZero()) {\n        continue\n      }\n      let decimals = await tokenContract.methods.decimals().call();\n      decimals = new BN(decimals.toString());\n      const symbol = await tokenContract.methods.symbol().call();\n\n      \n      allowances.push({\n        token: approval.token,\n        symbol: symbol,\n        spender: approval.spender,\n        allowance: allowance,\n        decimals: decimals\n      });\n    }\n\n\n    setFetching(false);\n    setAllowances(allowances);\n  }, [safe])\n\n  return <Container>\n    <Title size=\"sm\">ERC20 Token allowances of your Safe</Title>\n    {fetching ?\n      <Loader size=\"md\" />\n      :\n      <div>\n        <Button size=\"lg\" color=\"primary\" onClick={fetchAllowances}>Refresh</Button>\n        <TableContainer>\n          <Table>\n            <TableHead>\n              <TableRow>\n              <TableCell>\n                </TableCell>\n                <TableCell>\n                  Token\n                </TableCell>\n                <TableCell>\n                  Spender\n                </TableCell>\n                <TableCell>\n                  Allowance\n                </TableCell>\n\n              </TableRow>\n            </TableHead>\n              <TableBody>\n                {allowances.map((allowance: IAllowance, index) =>\n                  <TableRow key={index}>\n                     <TableCell>\n                      <Button size=\"lg\" color=\"primary\" onClick={() => resetAllowance(allowance.token, allowance.spender)}> Reset</Button>\n                    </TableCell>\n                    <TableCell>\n                      {/* TODO make etherscan link network agnostic */}\n                      <a href={etherscanLink + \"token/\" + allowance.token} target=\"_blank\">{allowance.symbol.toString()} </a>\n                    </TableCell>\n                    <TableCell>\n                    <a href={etherscanLink + \"address/\" + allowance.spender} target=\"_blank\">{allowance.spender} </a>\n                    </TableCell>\n                    <TableCell>\n                      {getAllowanceString(allowance.allowance, allowance.decimals)}\n                    </TableCell>\n\n                  </TableRow>\n                )}\n              </TableBody>\n    </Table>\n    </TableContainer>\n\n    </div>\n  }\n  </Container>\n    };\n\nexport default App;\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport { ThemeProvider } from \"styled-components\";\nimport { theme } from \"@gnosis.pm/safe-react-components\";\nimport { Loader, Title } from \"@gnosis.pm/safe-react-components\";\nimport SafeProvider from '@rmeissner/safe-apps-react-sdk';\n\n\nimport GlobalStyle from \"./GlobalStyle\";\nimport App from \"./App\";\n\nReactDOM.render(\n  <React.StrictMode>\n    <ThemeProvider theme={theme}>\n      <GlobalStyle />\n      <SafeProvider loading={(\n          <>\n            <Title size=\"md\">Waiting for Safe...</Title>\n            <Loader size=\"md\" />\n          </>\n        )}>\n        <App />\n      </SafeProvider>\n    </ThemeProvider>\n  </React.StrictMode>,\n  document.getElementById(\"root\")\n);\n"],"sourceRoot":""}